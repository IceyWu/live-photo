<h1 align="center">
  <br>
  <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="16" fill="#4F46E5"/>
    <path d="M85 45H73L70.2 40.4C69.9331 39.9011 69.5539 39.4752 69.0953 39.1581C68.6367 38.841 68.1119 38.6417 67.57 38.575C67.3808 38.5461 67.1905 38.5273 67 38.519H53C52.8095 38.5273 52.6192 38.5461 52.43 38.575C51.8881 38.6417 51.3633 38.841 50.9047 39.1581C50.4461 39.4752 50.0669 39.9011 49.8 40.4L47 45H35C33.6739 45 32.4021 45.5268 31.4645 46.4645C30.5268 47.4021 30 48.6739 30 50V80C30 81.3261 30.5268 82.5979 31.4645 83.5355C32.4021 84.4732 33.6739 85 35 85H85C86.3261 85 87.5979 84.4732 88.5355 83.5355C89.4732 82.5979 90 81.3261 90 80V50C90 48.6739 89.4732 47.4021 88.5355 46.4645C87.5979 45.5268 86.3261 45 85 45ZM60 77.5C57.0333 77.5 54.1332 76.7082 51.6665 75.2248C49.1997 73.7414 47.2771 71.6277 46.1418 69.1385C45.0065 66.6493 44.7094 63.8916 45.2882 61.2295C45.8669 58.5673 47.2956 56.1307 49.3934 54.2582C51.4912 52.3857 54.1939 51.1055 57.1477 50.5843C60.1015 50.0631 63.1599 50.3289 65.9107 51.3503C68.6615 52.3717 70.9927 54.1022 72.6265 56.3265C74.2604 58.5507 75.1111 61.1701 75.1111 63.8333C75.1111 67.4674 73.4493 70.9534 70.4877 73.5702C67.5261 76.187 63.5768 77.6667 59.4444 77.6667L60 77.5Z" fill="white"/>
    <circle cx="60" cy="64" r="12" fill="#4F46E5" stroke="white" stroke-width="3"/>
  </svg>
  <br>
  live-photo
  <br>
</h1>

<p align="center">ğŸš€ ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”è½»é‡çº§çš„ Live Photo ç½‘é¡µæŸ¥çœ‹å™¨ç»„ä»¶,å°† iOS é£æ ¼çš„å®æ—¶ç…§ç‰‡ä½“éªŒå¸¦åˆ°ç½‘é¡µç«¯ã€‚</p>

<p align="center">
<a href="https://www.npmjs.com/package/live-photo" target="__blank"><img src="https://img.shields.io/npm/v/live-photo?color=a1b858&label=" alt="NPM version"></a>
<a href="https://www.npmjs.com/package/live-photo" target="__blank"><img alt="NPM Downloads" src="https://img.shields.io/npm/dm/live-photo?color=50a36f&label="></a>
</p>

**ä¸­æ–‡** | [English](./README.md)

## âœ¨ ç‰¹æ€§

- ğŸ¯ **é›¶ä¾èµ–** - è½»é‡çº§å®ç°,æ— éœ€ä»»ä½•å¤–éƒ¨ä¾èµ–
- ğŸ“± **è·¨å¹³å°** - æ— ç¼æ”¯æŒç§»åŠ¨ç«¯(è§¦æ‘¸)å’Œæ¡Œé¢ç«¯(é¼ æ ‡)äº¤äº’
- ğŸ–¼ï¸ **æ™ºèƒ½åª’ä½“å¤„ç†** - ç…§ç‰‡å’Œè§†é¢‘ä¹‹é—´è‡ªåŠ¨åˆ‡æ¢,è¿‡æ¸¡æµç•…
- ğŸ¨ **é«˜åº¦å¯å®šåˆ¶** - çµæ´»çš„æ ·å¼å’Œé…ç½®é€‰é¡¹,æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘å…ƒç´ è‡ªå®šä¹‰
- ğŸ”„ **é«˜çº§åŠ è½½** - æ”¯æŒæ‡’åŠ è½½å’Œæ¸è¿›å¼è§†é¢‘åŠ è½½,å¸¦æœ‰è§†è§‰åé¦ˆ
- âš¡ **æ€§èƒ½ä¼˜åŒ–** - é«˜æ•ˆçš„èµ„æºç®¡ç†å’Œæ¸…ç†æœºåˆ¶
- ğŸ® **ä¸°å¯Œçš„ API** - å®Œå–„çš„å…¬å…±æ–¹æ³•å’Œäº‹ä»¶å›è°ƒ,å®ç°å®Œå…¨æ§åˆ¶
- ğŸ­ **äº¤äº’ä½“éªŒ** - é•¿æŒ‰æ’­æ”¾ã€ç‚¹å‡»æ£€æµ‹ã€è‡ªåŠ¨æ’­æ”¾æ¨¡å¼å’Œéœ‡åŠ¨åé¦ˆ
- ğŸ“Š **çŠ¶æ€ç®¡ç†** - å†…ç½®çŠ¶æ€è·Ÿè¸ªå’Œè®¢é˜…ç³»ç»Ÿ
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ,æä¾›å®Œæ•´ç±»å‹å®šä¹‰
- ğŸª **æ¡†æ¶æ— å…³** - æ”¯æŒåŸç”Ÿ JavaScriptã€Vueã€Reactã€Angular ç­‰

## ğŸ“¦ å®‰è£…

```bash
npm install live-photo
# æˆ–
pnpm add live-photo
# æˆ–
yarn add live-photo
# æˆ–
bun add live-photo
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æµè§ˆå™¨ (CDN)

```html
<script src="https://fastly.jsdelivr.net/npm/live-photo@latest"></script>

<div id="live-photo-container"></div>

<script>
  new LivePhotoViewer({
    photoSrc: 'path/to/photo.jpg',
    videoSrc: 'path/to/video.mp4',
    container: document.getElementById('live-photo-container'),
  });
</script>
```

### ES æ¨¡å—

```javascript
import { LivePhotoViewer } from 'live-photo';

const viewer = new LivePhotoViewer({
  photoSrc: 'path/to/photo.jpg',
  videoSrc: 'path/to/video.mp4',
  container: document.getElementById('live-photo-container'),
});
```

## ğŸ“– API å‚è€ƒ

### é…ç½®é€‰é¡¹

| å‚æ•°               | ç±»å‹                       | å¿…å¡« | é»˜è®¤å€¼  | æè¿°                                                     |
| ------------------ | -------------------------- | ---- | ------- | -------------------------------------------------------- |
| photoSrc           | string                     | âœ…   | -       | è¦æ˜¾ç¤ºçš„é™æ€å›¾ç‰‡ URL                                      |
| videoSrc           | string                     | âœ…   | -       | äº¤äº’æ—¶æ’­æ”¾çš„è§†é¢‘ URL                                      |
| container          | HTMLElement                | âœ…   | -       | æŒ‚è½½æŸ¥çœ‹å™¨çš„ DOM å…ƒç´                                      |
| width              | number \| string           | âŒ   | `300px` | æŸ¥çœ‹å™¨å®½åº¦(æ”¯æŒ pxã€%ã€vhã€vw ç­‰)                         |
| height             | number \| string           | âŒ   | `300px` | æŸ¥çœ‹å™¨é«˜åº¦(æ”¯æŒ pxã€%ã€vhã€vw ç­‰)                         |
| autoplay           | boolean                    | âŒ   | `true`  | å¯ç”¨æ‚¬åœ(æ¡Œé¢)æˆ–é•¿æŒ‰(ç§»åŠ¨ç«¯)æ—¶è‡ªåŠ¨æ’­æ”¾è§†é¢‘                |
| lazyLoadVideo      | boolean                    | âŒ   | `false` | å»¶è¿Ÿè§†é¢‘åŠ è½½,ç›´åˆ°æŸ¥çœ‹å™¨è¿›å…¥è§†å£                           |
| longPressDelay     | number                     | âŒ   | `300`   | åŒºåˆ†ç‚¹å‡»å’Œé•¿æŒ‰çš„æ—¶é—´é˜ˆå€¼(æ¯«ç§’)                            |
| borderRadius       | number \| string           | âŒ   | -       | å®¹å™¨çš„è¾¹æ¡†åœ†è§’(æ”¯æŒ pxã€%ã€rem ç­‰)                        |
| theme              | 'light' \| 'dark' \| 'auto'| âŒ   | -       | UI å…ƒç´ çš„é¢œè‰²ä¸»é¢˜                                         |
| preload            | 'auto' \| 'metadata' \| 'none' | âŒ | -    | è§†é¢‘é¢„åŠ è½½ç­–ç•¥                                            |
| retryAttempts      | number                     | âŒ   | `3`     | è§†é¢‘åŠ è½½å¤±è´¥æ—¶çš„é‡è¯•æ¬¡æ•°                                  |
| enableVibration    | boolean                    | âŒ   | `true`  | åœ¨æ”¯æŒçš„è®¾å¤‡ä¸Šå¯ç”¨éœ‡åŠ¨åé¦ˆ                                |
| staticBadgeIcon    | boolean                    | âŒ   | `false` | ä¿æŒå¾½ç« å›¾æ ‡é™æ€(æ— æ–œæ ),ä¸éš autoplay çŠ¶æ€å˜åŒ–           |
| imageCustomization | ElementCustomization       | âŒ   | -       | å›¾ç‰‡å…ƒç´ çš„è‡ªå®šä¹‰å±æ€§å’Œæ ·å¼                                |
| videoCustomization | ElementCustomization       | âŒ   | -       | è§†é¢‘å…ƒç´ çš„è‡ªå®šä¹‰å±æ€§å’Œæ ·å¼                                |

### ElementCustomization æ¥å£

```typescript
interface ElementCustomization {
  attributes?: Record<string, string>;  // HTML å±æ€§(å¦‚ { alt: "...", loading: "lazy" })
  styles?: Partial<CSSStyleDeclaration>; // CSS æ ·å¼(å¦‚ { objectFit: "cover" })
}
```

### äº‹ä»¶å›è°ƒ

| å›è°ƒ           | å‚æ•°                     | æè¿°                                    |
| -------------- | ------------------------ | --------------------------------------- |
| onPhotoLoad    | `() => void`             | å›¾ç‰‡åŠ è½½å®Œæˆæ—¶è§¦å‘                      |
| onVideoLoad    | `() => void`             | è§†é¢‘åŠ è½½å®Œæˆæ—¶è§¦å‘                      |
| onCanPlay      | `() => void`             | è§†é¢‘å‡†å¤‡å¥½æ’­æ”¾æ—¶è§¦å‘                    |
| onLoadStart    | `() => void`             | è§†é¢‘å¼€å§‹åŠ è½½æ—¶è§¦å‘(æ‡’åŠ è½½æ¨¡å¼)          |
| onLoadProgress | `(loaded, total) => void`| è§†é¢‘ä¸‹è½½è¿›åº¦æ—¶è§¦å‘                      |
| onProgress     | `(progress) => void`     | è§†é¢‘ç¼“å†²è¿›åº¦æ—¶è§¦å‘(0-100)               |
| onEnded        | `() => void`             | è§†é¢‘æ’­æ”¾å®Œæˆæ—¶è§¦å‘                      |
| onClick        | `() => void`             | çŸ­æŒ‰/ç‚¹å‡»æ—¶è§¦å‘                         |
| onError        | `(error) => void`        | å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘                          |

### LivePhotoError æ¥å£

```typescript
interface LivePhotoError {
  type: 'VIDEO_LOAD_ERROR' | 'PHOTO_LOAD_ERROR' | 'PLAYBACK_ERROR' | 'VALIDATION_ERROR';
  message: string;
  originalError?: Error;
}
```

### å…¬å…±æ–¹æ³•

æ‰€æœ‰æ–¹æ³•éƒ½å¯åœ¨ `LivePhotoViewer` å®ä¾‹ä¸Šä½¿ç”¨:

| æ–¹æ³•             | è¿”å›å€¼          | æè¿°                                    |
| ---------------- | --------------- | --------------------------------------- |
| `play()`         | `Promise<void>` | å¼€å§‹æˆ–æ¢å¤è§†é¢‘æ’­æ”¾                      |
| `pause()`        | `void`          | æš‚åœè§†é¢‘æ’­æ”¾                            |
| `stop()`         | `void`          | åœæ­¢è§†é¢‘å¹¶é‡ç½®åˆ°å¼€å§‹ä½ç½®                |
| `toggle()`       | `void`          | åˆ‡æ¢æ’­æ”¾å’Œæš‚åœçŠ¶æ€                      |
| `getState()`     | `LivePhotoState`| è·å–å½“å‰æŸ¥çœ‹å™¨çŠ¶æ€(åªè¯»)                |
| `destroy()`      | `void`          | æ¸…ç†èµ„æºå¹¶ä» DOM ä¸­ç§»é™¤æŸ¥çœ‹å™¨           |

### LivePhotoState æ¥å£

```typescript
interface LivePhotoState {
  isPlaying: boolean;           // è§†é¢‘æ˜¯å¦æ­£åœ¨æ’­æ”¾
  autoplay: boolean;            // å½“å‰çš„è‡ªåŠ¨æ’­æ”¾è®¾ç½®
  videoError: boolean;          // è§†é¢‘åŠ è½½æ˜¯å¦å¤±è´¥
  videoLoaded: boolean;         // è§†é¢‘æ˜¯å¦å·²åŠ è½½
  aspectRatio: number;          // è®¡ç®—å‡ºçš„ç…§ç‰‡çºµæ¨ªæ¯”
  isLongPressPlaying: boolean;  // æ˜¯å¦å› é•¿æŒ‰è€Œæ’­æ”¾
}
```

## ğŸ¯ å·¥ä½œåŸç†

### æ¡Œé¢ç«¯äº¤äº’
- **æ‚¬åœåœ¨å¾½ç« ä¸Š**: æ‚¬åœåœ¨ LIVE å¾½ç« ä¸Šæ—¶è‡ªåŠ¨æ’­æ”¾è§†é¢‘(å¦‚æœå¯ç”¨äº†è‡ªåŠ¨æ’­æ”¾)
- **ç§»å¼€é¼ æ ‡**: è§†é¢‘åœæ­¢å¹¶è¿”å›ç…§ç‰‡
- **ç‚¹å‡»å¾½ç« **: æ‰“å¼€ä¸‹æ‹‰èœå•ä»¥åˆ‡æ¢è‡ªåŠ¨æ’­æ”¾è®¾ç½®

### ç§»åŠ¨ç«¯äº¤äº’
- **é•¿æŒ‰**: æŒ‰ä½ç…§ç‰‡æ’­æ”¾è§†é¢‘
- **é‡Šæ”¾**: è§†é¢‘åœæ­¢å¹¶è¿”å›ç…§ç‰‡
- **çŸ­æŒ‰**: è§¦å‘ `onClick` å›è°ƒè€Œä¸æ’­æ”¾è§†é¢‘
- **è§¦è§‰åé¦ˆ**: åœ¨æ”¯æŒçš„è®¾å¤‡ä¸Šæä¾›éœ‡åŠ¨åé¦ˆ(å¦‚æœå¯ç”¨)

### åŠ è½½è¡Œä¸º
- **æ ‡å‡†åŠ è½½**: è§†é¢‘éšç»„ä»¶ç«‹å³åŠ è½½
- **æ‡’åŠ è½½**: ä»…å½“æŸ¥çœ‹å™¨è¿›å…¥è§†å£æ—¶æ‰åŠ è½½è§†é¢‘
- **è¿›åº¦æŒ‡ç¤ºå™¨**: è§†è§‰åé¦ˆåœ¨ LIVE å¾½ç« ä¸­æ˜¾ç¤ºåŠ è½½è¿›åº¦
- **é”™è¯¯æ¢å¤**: å¤±è´¥åŠ è½½çš„è‡ªåŠ¨é‡è¯•æœºåˆ¶

## ğŸ¨ è‡ªå®šä¹‰

### æ ·å¼é…ç½®

```javascript
const viewer = new LivePhotoViewer({
  photoSrc: "photo.jpg",
  videoSrc: "video.mp4",
  container: document.getElementById("container"),
  
  // å®¹å™¨æ ·å¼
  width: "100%",
  height: "auto",
  borderRadius: "16px",
  theme: "dark",
  
  // å›¾ç‰‡è‡ªå®šä¹‰
  imageCustomization: {
    styles: {
      objectFit: "cover",
      filter: "brightness(1.1)",
    },
    attributes: {
      alt: "æˆ‘çš„å®æ—¶ç…§ç‰‡",
      loading: "lazy",
      draggable: "false",
    },
  },
  
  // è§†é¢‘è‡ªå®šä¹‰
  videoCustomization: {
    styles: {
      objectFit: "contain",
      filter: "contrast(1.1)",
    },
    attributes: {
      preload: "metadata",
    },
  },
});
```

### è‡ªå®šä¹‰ CSS

å¯ä»¥ä½¿ç”¨ CSS è¦†ç›–é»˜è®¤æ ·å¼:

```css
/* å®¹å™¨ */
.live-photo-container {
  border: 2px solid #4F46E5;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* å¾½ç«  */
.live-photo-badge {
  background: rgba(0, 0, 0, 0.8) !important;
  backdrop-filter: blur(10px);
}

/* æ’­æ”¾çŠ¶æ€ */
.live-photo-container.playing {
  transform: scale(1.02);
  transition: transform 0.3s ease;
}

/* ä¸‹æ‹‰èœå• */
.dropdown-menu {
  background: rgba(255, 255, 255, 0.95);
}
```

## ğŸ”§ æµè§ˆå™¨æ”¯æŒ

- âœ… Chrome (æœ€æ–°ç‰ˆ)
- âœ… Firefox (æœ€æ–°ç‰ˆ)
- âœ… Safari (æœ€æ–°ç‰ˆ)
- âœ… Edge (æœ€æ–°ç‰ˆ)
- âœ… ç§»åŠ¨æµè§ˆå™¨ (iOS Safari, Chrome Mobile)

### è¦æ±‚
- æ”¯æŒ ES6+ çš„ç°ä»£æµè§ˆå™¨
- æ”¯æŒ `IntersectionObserver`(ç”¨äºæ‡’åŠ è½½)
- æ”¯æŒ `Promise` å’Œ `async/await`

## ğŸ“‹ æœ€ä½³å®è·µ

1. **ä¼˜åŒ–åª’ä½“æ–‡ä»¶**
   - ä½¿ç”¨å‹ç¼©çš„å›¾ç‰‡æ ¼å¼(JPEGã€WebP)
   - ä½¿ç”¨çŸ­è§†é¢‘ç‰‡æ®µ(å»ºè®® 2-3 ç§’)
   - è€ƒè™‘ä½¿ç”¨è‡ªé€‚åº”æ¯”ç‰¹ç‡è§†é¢‘ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½

2. **ä½¿ç”¨æ‡’åŠ è½½**
   - ä¸ºé¦–å±ä»¥ä¸‹çš„å†…å®¹å¯ç”¨ `lazyLoadVideo: true`
   - æé«˜åˆå§‹é¡µé¢åŠ è½½æ€§èƒ½

3. **ä¼˜é›…åœ°å¤„ç†é”™è¯¯**
   - å§‹ç»ˆå®ç° `onError` å›è°ƒ
   - ä¸ºåŠ è½½å¤±è´¥æä¾›å¤‡ç”¨ UI

4. **æ¸…ç†èµ„æº**
   - ç§»é™¤æŸ¥çœ‹å™¨æ—¶è°ƒç”¨ `destroy()` æ–¹æ³•
   - åœ¨ SPA(å•é¡µåº”ç”¨)ä¸­ç‰¹åˆ«é‡è¦

5. **å“åº”å¼è®¾è®¡**
   - ä½¿ç”¨ç›¸å¯¹å•ä½(`%`ã€`vh`ã€`vw`)å®ç°å“åº”å¼å°ºå¯¸
   - ä¸ºæ‚¨çš„å®½é«˜æ¯”è®¾ç½®é€‚å½“çš„ `objectFit` å€¼

## ğŸ› æ•…éšœæ’é™¤

### ç§»åŠ¨ç«¯è§†é¢‘æ— æ³•æ’­æ”¾
- ç¡®ä¿è§†é¢‘å…·æœ‰ `muted` å±æ€§(ç»„ä»¶è‡ªåŠ¨è®¾ç½®)
- æ£€æŸ¥è§†é¢‘æ ¼å¼æ˜¯å¦å—æ”¯æŒ(æ¨è MP4 H.264)
- éªŒè¯æ˜¯å¦è®¾ç½®äº† `playsInline`(ç»„ä»¶è‡ªåŠ¨è®¾ç½®)

### è§†é¢‘æ— æ³•åŠ è½½
- æ£€æŸ¥è§†é¢‘ URL æ˜¯å¦å¯è®¿é—®ä¸”å¯ç”¨äº† CORS
- éªŒè¯è§†é¢‘æ–‡ä»¶æœªæŸå
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„å…·ä½“é”™è¯¯
- å°è¯•å¢åŠ  `retryAttempts` é€‰é¡¹

### æ€§èƒ½é—®é¢˜
- ä¸ºä¸€ä¸ªé¡µé¢ä¸Šçš„å¤šä¸ªæŸ¥çœ‹å™¨å¯ç”¨ `lazyLoadVideo`
- ä¼˜åŒ–è§†é¢‘æ–‡ä»¶å¤§å°å’Œæ ¼å¼
- è€ƒè™‘ä½¿ç”¨æ›´çŸ­çš„è§†é¢‘ç‰‡æ®µ

### è‡ªåŠ¨æ’­æ”¾ä¸å·¥ä½œ
- éªŒè¯é€‰é¡¹ä¸­è®¾ç½®äº† `autoplay: true`
- æ£€æŸ¥è§†é¢‘æ˜¯å¦é™éŸ³(æµè§ˆå™¨è¦æ±‚è‡ªåŠ¨æ’­æ”¾å¿…é¡»é™éŸ³)
- æ¡Œé¢ç«¯:ç¡®ä¿æ‚¨æ‚¬åœåœ¨å¾½ç« ä¸Š
- ç§»åŠ¨ç«¯:æ”¹ç”¨é•¿æŒ‰(è‡ªåŠ¨æ’­æ”¾å·¥ä½œæ–¹å¼ä¸åŒ)

## ğŸ”§ å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼(ç›‘å¬)
pnpm dev

# ç”Ÿäº§æ„å»º
pnpm build

# è¿è¡Œ playground
cd playground
pnpm dev
```

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®!è¯·éšæ—¶æäº¤ Pull Requestã€‚

1. Fork ä»“åº“
2. åˆ›å»ºæ‚¨çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ Pull Request

## ğŸ’– æ”¯æŒ

å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªé¡¹ç›®æœ‰å¸®åŠ©,è¯·è€ƒè™‘:
- â­ ç»™ä»“åº“ç‚¹æ˜Ÿ
- ğŸ› æŠ¥å‘Š bug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“– æ”¹è¿›æ–‡æ¡£

## ğŸ“¬ è”ç³»æ–¹å¼

- ä½œè€…: Icey Wu
- é‚®ç®±: 3128006406@qq.com
- GitHub: [@IceyWu](https://github.com/iceywu)

## ğŸ™ è‡´è°¢

çµæ„Ÿæ¥è‡ª Apple åœ¨ iOS è®¾å¤‡ä¸Šçš„ Live Photos åŠŸèƒ½ã€‚

---

ç”¨ â¤ï¸ åˆ¶ä½œ,ä½œè€… [Icey Wu](https://github.com/iceywu)

## ï¿½ ä½¿ç”¨ç¤ºä¾‹

### åŸç”Ÿ JavaScript

[æŸ¥çœ‹å®Œæ•´ HTML ç¤ºä¾‹](./demo/html-demo.html)

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Photo æ¼”ç¤º</title>
  <script src="https://fastly.jsdelivr.net/npm/live-photo@latest"></script>
</head>
<body>
  <div id="live-photo-container"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const container = document.getElementById("live-photo-container");
      
      const viewer = new LivePhotoViewer({
        photoSrc: "https://example.com/photo.jpg",
        videoSrc: "https://example.com/video.mp4",
        container: container,
        width: 400,
        height: 600,
        borderRadius: "12px",
        autoplay: true,
        lazyLoadVideo: true,
        enableVibration: true,
        imageCustomization: {
          styles: {
            objectFit: "cover",
          },
          attributes: {
            alt: "ç¾ä¸½çš„å®æ—¶ç…§ç‰‡",
            loading: "lazy",
          },
        },
        videoCustomization: {
          styles: {
            objectFit: "cover",
          },
        },
        // äº‹ä»¶å›è°ƒ
        onPhotoLoad: () => console.log("ç…§ç‰‡å·²åŠ è½½"),
        onVideoLoad: () => console.log("è§†é¢‘å·²åŠ è½½"),
        onProgress: (progress) => console.log(`åŠ è½½ä¸­: ${progress}%`),
        onError: (error) => console.error("é”™è¯¯:", error),
        onClick: () => console.log("å·²ç‚¹å‡»!"),
      });

      // é€šè¿‡ç¼–ç¨‹æ–¹å¼æ§åˆ¶æ’­æ”¾
      // viewer.play();
      // viewer.pause();
      // viewer.stop();
      // viewer.toggle();
      
      // è·å–å½“å‰çŠ¶æ€
      // const state = viewer.getState();
      // console.log(state.isPlaying, state.autoplay);
    });
  </script>
</body>
</html>
```

### Vue 3 (ç»„åˆå¼ API)

[æŸ¥çœ‹å®Œæ•´ Vue 3 ç¤ºä¾‹](./demo/vue3-demo.html)

```vue
<template>
  <div ref="containerRef"></div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from "vue";
import { LivePhotoViewer } from "live-photo";
import type { LivePhotoAPI } from "live-photo";

const containerRef = ref<HTMLElement | null>(null);
const viewerInstance = ref<LivePhotoAPI | null>(null);

onMounted(() => {
  if (containerRef.value) {
    viewerInstance.value = new LivePhotoViewer({
      photoSrc: "https://example.com/photo.jpg",
      videoSrc: "https://example.com/video.mp4",
      container: containerRef.value,
      width: 400,
      height: 600,
      borderRadius: "12px",
      autoplay: true,
      lazyLoadVideo: true,
      enableVibration: true,
      imageCustomization: {
        styles: {
          objectFit: "cover",
        },
        attributes: {
          alt: "ç¾ä¸½çš„å®æ—¶ç…§ç‰‡",
          loading: "lazy",
        },
      },
      videoCustomization: {
        styles: {
          objectFit: "cover",
        },
      },
      onPhotoLoad: () => console.log("ç…§ç‰‡å·²åŠ è½½"),
      onVideoLoad: () => console.log("è§†é¢‘å·²åŠ è½½"),
      onProgress: (progress) => console.log(`åŠ è½½ä¸­: ${progress}%`),
      onError: (error) => console.error("é”™è¯¯:", error),
      onClick: () => console.log("å·²ç‚¹å‡»!"),
    });
  }
});

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†
onUnmounted(() => {
  if (viewerInstance.value) {
    viewerInstance.value.destroy();
  }
});

// ç¤ºä¾‹:æ§åˆ¶æ–¹æ³•
const play = () => viewerInstance.value?.play();
const pause = () => viewerInstance.value?.pause();
const toggle = () => viewerInstance.value?.toggle();
</script>
```

### React (TypeScript)

[æŸ¥çœ‹å®Œæ•´ React ç¤ºä¾‹](./demo/react-demo.html)

```tsx
import React, { useEffect, useRef } from "react";
import { LivePhotoViewer } from "live-photo";
import type { LivePhotoAPI } from "live-photo";

const LivePhotoComponent: React.FC = () => {
  const containerRef = useRef<HTMLDivElement>(null);
  const viewerRef = useRef<LivePhotoAPI | null>(null);

  useEffect(() => {
    if (containerRef.current) {
      viewerRef.current = new LivePhotoViewer({
        photoSrc: "https://example.com/photo.jpg",
        videoSrc: "https://example.com/video.mp4",
        container: containerRef.current,
        width: 400,
        height: 600,
        borderRadius: "12px",
        autoplay: true,
        lazyLoadVideo: true,
        enableVibration: true,
        imageCustomization: {
          styles: {
            objectFit: "cover",
          },
          attributes: {
            alt: "ç¾ä¸½çš„å®æ—¶ç…§ç‰‡",
            loading: "lazy",
          },
        },
        videoCustomization: {
          styles: {
            objectFit: "cover",
          },
        },
        onPhotoLoad: () => console.log("ç…§ç‰‡å·²åŠ è½½"),
        onVideoLoad: () => console.log("è§†é¢‘å·²åŠ è½½"),
        onProgress: (progress) => console.log(`åŠ è½½ä¸­: ${progress}%`),
        onError: (error) => console.error("é”™è¯¯:", error),
        onClick: () => console.log("å·²ç‚¹å‡»!"),
      });
    }

    // å¸è½½æ—¶æ¸…ç†
    return () => {
      if (viewerRef.current) {
        viewerRef.current.destroy();
      }
    };
  }, []);

  // ç¤ºä¾‹:æ§åˆ¶æ–¹æ³•
  const handlePlay = () => viewerRef.current?.play();
  const handlePause = () => viewerRef.current?.pause();
  const handleToggle = () => viewerRef.current?.toggle();

  return (
    <div>
      <div ref={containerRef}></div>
      <div>
        <button onClick={handlePlay}>æ’­æ”¾</button>
        <button onClick={handlePause}>æš‚åœ</button>
        <button onClick={handleToggle}>åˆ‡æ¢</button>
      </div>
    </div>
  );
};

export default LivePhotoComponent;
```

### é«˜çº§ç”¨æ³•

#### ä½¿ç”¨ Intersection Observer æ‡’åŠ è½½

```javascript
const viewer = new LivePhotoViewer({
  photoSrc: "photo.jpg",
  videoSrc: "video.mp4",
  container: document.getElementById("container"),
  lazyLoadVideo: true, // ä»…å½“æŸ¥çœ‹å™¨è¿›å…¥è§†å£æ—¶æ‰åŠ è½½è§†é¢‘
  onLoadStart: () => {
    console.log("è§†é¢‘å¼€å§‹åŠ è½½");
  },
  onProgress: (progress) => {
    console.log(`è§†é¢‘ç¼“å†²ä¸­: ${progress}%`);
  },
});
```

#### è‡ªå®šä¹‰é”™è¯¯å¤„ç†

```javascript
const viewer = new LivePhotoViewer({
  photoSrc: "photo.jpg",
  videoSrc: "video.mp4",
  container: document.getElementById("container"),
  retryAttempts: 5, // å¤±è´¥æ—¶é‡è¯• 5 æ¬¡
  onError: (error) => {
    switch (error.type) {
      case 'VIDEO_LOAD_ERROR':
        console.error("è§†é¢‘åŠ è½½å¤±è´¥:", error.message);
        // æ˜¾ç¤ºå¤‡ç”¨ UI
        break;
      case 'PHOTO_LOAD_ERROR':
        console.error("ç…§ç‰‡åŠ è½½å¤±è´¥:", error.message);
        break;
      case 'PLAYBACK_ERROR':
        console.error("æ’­æ”¾å¤±è´¥:", error.message);
        break;
    }
  },
});
```

#### çŠ¶æ€è®¢é˜…

```javascript
const viewer = new LivePhotoViewer({
  photoSrc: "photo.jpg",
  videoSrc: "video.mp4",
  container: document.getElementById("container"),
});

// è·å–å½“å‰çŠ¶æ€
const state = viewer.getState();
console.log(state.isPlaying); // false
console.log(state.autoplay);  // true

// æ³¨æ„:å¯¹äºå“åº”å¼çŠ¶æ€æ›´æ–°,å¯ä»¥è½®è¯¢ getState()
// æˆ–ä½¿ç”¨äº‹ä»¶å›è°ƒ
```

#### å“åº”å¼å°ºå¯¸

```javascript
const viewer = new LivePhotoViewer({
  photoSrc: "photo.jpg",
  videoSrc: "video.mp4",
  container: document.getElementById("container"),
  width: "100%",      // å“åº”å¼å®½åº¦
  height: "50vh",     // è§†å£é«˜åº¦çš„ 50%
  borderRadius: "1rem",
  imageCustomization: {
    styles: {
      objectFit: "cover",  // ä¿æŒå®½é«˜æ¯”
    },
  },
});
```
